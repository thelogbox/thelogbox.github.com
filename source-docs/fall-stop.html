<!-- filename: fall-stop.haml -->
<!-- author: Ted Hagos -->
<!DOCTYPE html>
<html>
  <head>
    <script src='http://code.jquery.com/jquery-1.8.2.min.js'></script>
    <script>
		
		// Generated by CoffeeScript 1.3.3

		/*

		Goal. 1 box will fall, then stop at the bottom of the canvas 

		I need to refactor and make factory for the boxes. I also need a way to keep
		track of which boxes have already fallen, and redraw them.  

		Exercise on collision detection. I need to know if a falling box is colliding with a box
		that has already fallen.

		Next stop. Falling boxes. When the boxes fall, they need to stay at the bottom.
		Also, as the squares fall, make them rotate -- added difficulty, put some bounce as they fall
		on the edge of the canvas -- next level difficulty, make them stack, like tetris.

		How about it slows down (decelerates) 30px before it reaches th bottom of the canvas 
		 (like a parachute)

		Next step, make it tetris
		*/


		(function() {
		  var Box, Stage,
		    __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };

		  Box = (function() {
		    var box, canvas;

		    canvas = null;

		    box = null;

		    function Box(canvas) {
		      this.canvas = canvas;
		      this.x = Math.random() * canvas.width / 2;
		      this.y = 0;
		      this.width = 50;
		      this.height = 50;
		      this.speed = 1;
		      this.acceleration = .98;
		      this.at_rest = false;
		    }

		    return Box;

		  })();

		  Stage = (function() {
		    var box, c, ctx, stopAnimation;

		    c = ctx = box = null;

		    stopAnimation = false;

		    function Stage(canvas, context) {
		      this.draw = __bind(this.draw, this);
		      c = canvas;
		      ctx = context;
		      box = new Box(c);
		      this.draw();
		    }

		    Stage.prototype.draw = function() {
		      var foo;
		      ctx.clearRect(0, 0, c.width, c.height);
		      if ((box.y + box.height) <= (c.height - box.height)) {
		        box.y += box.speed;
		        box.speed += box.acceleration;
		        ctx.strokeRect(box.x, box.y, box.width, box.height);
		        return foo = setTimeout(this.draw, 60);
		      } else {
		        return ctx.strokeRect(box.x, c.height - box.height, box.width, box.height);
		      }
		    };

		    return Stage;

		  })();

		  $(window).ready(function() {
		    var canvas, context;
		    canvas = $('#mycanvas').get(0);
		    context = canvas.getContext('2d');
		    return $('#fall').click(function() {
		      var stage;
		      return stage = new Stage(canvas, context);
		    });
		  });

		}).call(this);
		
		
		</script>
  </head>
  <body>
    <canvas height='500' id='mycanvas' style='border-bottom: 2px dotted gray; border-top: 2px dotted gray;' width='400'></canvas>
    <div id='spacer'>
      <input id='fall' style='text-align: left' type='button' value='Fall' />
    </div>
  </body>
</html>
