<!-- filename: falling-boxes.haml -->
<!-- author: Ted Hagos -->
<!DOCTYPE html>
<html>
  <head>
    <script src='http://code.jquery.com/jquery-1.8.2.min.js'></script>
    <script>
		
		(function() {
		  var Box, Stage,
		    __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };

		  Box = (function() {
		    var box, canvas;

		    canvas = null;

		    box = null;

		    function Box(canvas) {
		      this.canvas = canvas;
		      this.getColor = __bind(this.getColor, this);

		      this.x = Math.random() * canvas.width;
		      this.y = Math.random() * (canvas.height / 2);
		      this.width = Math.random() * 40;
		      this.height = this.width;
		      this.speed = 1;
		      this.acceleration = 1;
		      this.at_rest = false;
		      this.color = this.getColor();
		    }

		    Box.prototype.getColor = function() {
		      var colors;
		      colors = ['gray', 'blue', 'orange', 'red', 'blue', 'gray', 'black', 'green', 'yellow'];
		      return colors[Math.round(Math.random() * 9)];
		    };

		    return Box;

		  })();

		  Stage = (function() {
		    var box, boxes, c, ctx, numbox, stopAnimation;

		    c = ctx = box = null;

		    stopAnimation = false;

		    numbox = 0;

		    boxes = new Array();

		    function Stage(canvas, context, mnumbox) {
		      this.draw = __bind(this.draw, this);

		      var b, i, _i;
		      c = canvas;
		      ctx = context;
		      numbox = mnumbox;
		      for (i = _i = 1; 1 <= numbox ? _i <= numbox : _i >= numbox; i = 1 <= numbox ? ++_i : --_i) {
		        b = new Box(c);
		        boxes.push(b);
		      }
		      this.draw();
		    }

		    Stage.prototype.draw = function() {
		      var i, _i, _len;
		      ctx.clearRect(0, 0, c.width, c.height);
		      for (_i = 0, _len = boxes.length; _i < _len; _i++) {
		        i = boxes[_i];
		        ctx.save();
		        ctx.fillStyle = i.color;
		        ctx.fillRect(i.x, i.y, i.width, i.height);
		        ctx.restore();
		        if ((i.y + i.height) >= (c.height - i.height)) {
		          i.at_rest = true;
		        }
		        if (i.at_rest !== true) {
		          i.y += i.speed;
		          i.speed += i.acceleration;
		        }
		      }
		      return setTimeout(this.draw, 60);
		    };

		    return Stage;

		  })();

		  $(window).ready(function() {
		    var canvas, context;
		    canvas = $('#mycanvas').get(0);
		    context = canvas.getContext('2d');
		    return document.getElementById('btn').onclick = function() {
		      var numbox, stage;
		      if (stage === !null) {
		        stage = null;
		      }
		      numbox = $('#numbox').val();
		      $('#numbox').val('');
		      return stage = new Stage(canvas, context, numbox);
		    };
		  });

		}).call(this);

		
		</script>
  </head>
  <body>
    <div id='div'>
      <canvas height='500' id='mycanvas' style='border: 1px solid gray' width='500'></canvas>
    </div>
    <div id='div'>
      number of boxes:
      <input id='numbox' type='text' />
      <input id='btn' type='button' value='Start' />
    </div>
    <hr />
    <div id='div'>
      <h1>Instructions</h1>
      <ol>
        <li>Create a canvas 500px (w) by 400px (h)</li>
        <li>Create a text box to accept numeric input. There is no need to validate for now, it's quite okay if you wont validate</li>
        <li>Create a button object</li>
      </ol>
      <h1>How the exercise works</h1>
      <p></p>
      Type a number into the textbox, this will be the total number of boxes that needs to be created inside the canvas. The size of the boxes is randomized, but they cannot be more than 40px
      <p></p>
      Not all boxes will start to fall at y:0, they can fall from any altitude but none of the boxes can fall below the halfway point of the canvas' height
      <p></p>
      The boxes needs to stop falling when they reach the bottom of the canvas -- as you could see, even my code has a bug right now. They are not falling exactly at the bottom of the canvas, so for the purpose of the exercise, yours may not fall exactly at the bottom too, there could some clearance. When I have the time, I will solve the bug---if you can solve it in your exercise, that is well good.
      <p></p>
      Optional: the colors the boxes can be randomized -- you don't have to solve this though, but it would be nice it you could
      <h3>Good luck.</h3>
    </div>
  </body>
</html>
