<!DOCTYPE HTML>
<html lang="en">
  <head>
		<meta charset="utf-8">
<title>Notes on using Sinatra: theLogBox.com</title>

<link href='http://fonts.googleapis.com/css?family=PT+Sans+Narrow:400,700' rel='stylesheet' type='text/css'>
<link href='http://fonts.googleapis.com/css?family=Neuton:300,400italic' rel='stylesheet' type='text/css'>
<link href='http://fonts.googleapis.com/css?family=Source+Code+Pro' rel='stylesheet' type='text/css'>

<link href='http://fonts.googleapis.com/css?family=Open+Sans:400,600,700' rel='stylesheet' type='text/css'>

<link rel="stylesheet" type="text/css" href="/style.css" media="screen">


<meta name="google-site-verification" content="h3sz9mbRignTr-OFf8zOhJa_-2HaneH4frxtac50oFU" />

		<!-- Google webmaster and Analytics -->
   <meta name="google-site-verification" content="h3sz9mbRignTr-OFf8zOhJa_-2HaneH4frxtac50oFU" />
   <script type="text/javascript">

   var _gaq = _gaq || [];
   _gaq.push(['_setAccount', 'UA-30546856-1']);
   _gaq.push(['_setDomainName', '.thelogbox.com']);
   _gaq.push(['_trackPageview']);

   (function() {
       var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
       ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
       var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
   })();

   </script>
   <!-- end Google webmaster and analytics -->	
  </head>
  <body>
		  
    <div id="main" itemscope itemtype="http://schema.org/Article">

	  <header>
      
<div id='navleft'>
<a href='/'>{theLogBox}</a>
</div>

<div id='navright'>
  <a href=''>courses</a> &nbsp;&nbsp;
    <a href=''>blog</a> 
</div>
    </header>

	  <div id="articletitle" itemprop="headline">Notes on using Sinatra</div>  
    <div id='contentmeta'>
by: 
<a href="https://plus.google.com/107317535953221277825?rel=author">
  Ted Hagos
</a> on 

<span itemprop="dateCreated"> October 12, 2012 </span>
</div>  

	  <div itemprop="articleBody">
      <h1 id="up-and-running">1. Up and running</h1>
<p>


</p><ol style="list-style-type: decimal">
<li><p>Switch your ruby version</p></li>
<li>Install Sinatra <strong>$ sudo gem install sinatra</strong>. While you are it, install the <em>thin</em> package as well <strong>$ sudo gem install thin</strong>. Sinatra apps will run without thin</li>
<li><p>Make sure it's running, do the HelloWorld app</p></li>
</ol><pre><code class="language-ruby"><span class="line-numbers">10</span><span class="comment"># helloworld.rb</span>
<span class="line-numbers">11</span>
<span class="line-numbers">12</span>require <span class="string"><span class="delimiter">'</span><span class="content">rubygems</span><span class="delimiter">'</span></span> <span class="keyword">if</span> <span class="predefined-constant">RUBY_VERSION</span> &lt; <span class="string"><span class="delimiter">'</span><span class="content">1.9</span><span class="delimiter">'</span></span>
<span class="line-numbers">13</span>require <span class="string"><span class="delimiter">'</span><span class="content">sinatra</span><span class="delimiter">'</span></span>
<span class="line-numbers">14</span>
<span class="line-numbers">15</span>get <span class="string"><span class="delimiter">'</span><span class="content">/</span><span class="delimiter">'</span></span> <span class="keyword">do</span>
<span class="line-numbers">16</span>    <span class="string"><span class="delimiter">"</span><span class="content">Hello World</span><span class="delimiter">"</span></span>
<span class="line-numbers">17</span><span class="keyword">end</span></code></pre>
<p>Run the web program using <strong>$ruby helloworld.rb</strong>. Open a web browser, if you can you see "Hello World" on http://localhost:4567, then Sinatra is up and running and you did not make a mess of the sample code</p>
<h1 id="put-some-structure-and-abstractions">2. Put some structure and abstractions</h1>
<p>It doesn't hurt to enclose the Sinatra routes in classes</p>
<pre><code class="language-ruby"><span class="line-numbers">10</span><span class="comment"># helloworld.rb</span>
<span class="line-numbers">11</span>
<span class="line-numbers">12</span>require <span class="string"><span class="delimiter">'</span><span class="content">rubygems</span><span class="delimiter">'</span></span> <span class="keyword">if</span> <span class="predefined-constant">RUBY_VERSION</span> &lt; <span class="string"><span class="delimiter">'</span><span class="content">1.9</span><span class="delimiter">'</span></span>
<span class="line-numbers">13</span>require <span class="string"><span class="delimiter">'</span><span class="content">sinatra</span><span class="delimiter">'</span></span>
<span class="line-numbers">14</span>
<span class="line-numbers">15</span><span class="keyword">class</span> <span class="class">First</span> &lt; <span class="constant">Sinatra</span>::<span class="constant">Base</span>
<span class="line-numbers">16</span>    get <span class="string"><span class="delimiter">'</span><span class="content">/</span><span class="delimiter">'</span></span> <span class="keyword">do</span>
<span class="line-numbers">17</span>        <span class="string"><span class="delimiter">"</span><span class="content">Hello World</span><span class="delimiter">"</span></span>
<span class="line-numbers">18</span>    <span class="keyword">end</span>
<span class="line-numbers">19</span><span class="keyword">end</span>
<span class="line-numbers">20</span>
<span class="line-numbers">21</span><span class="constant">First</span>.run!</code></pre>
<p>run it again using <strong>$ ruby helloworld.rb</strong>, you may need to stop the currently running web server install on the terminal (CTRL-C)</p>
<h1 id="using-rackup-with-sinatra">3. Using RackUp with Sinatra</h1>
<h2 id="create-a-config.ru-file">3.1 Create a config.ru file</h2>
<p>

</p><pre><code class="language-ruby"><span class="line-numbers">10</span><span class="comment"># config.ru</span>
<span class="line-numbers">11</span>
<span class="line-numbers">12</span>require <span class="string"><span class="delimiter">'</span><span class="content">helloworld</span><span class="delimiter">'</span></span>
<span class="line-numbers">13</span>
<span class="line-numbers">14</span><span class="constant">First</span>.run!
<span class="line-numbers">15</span>
<span class="line-numbers">16</span><span class="comment"># First.new would have worked as well</span>
<span class="line-numbers">17</span><span class="comment">#   creating a new instance of a Sinatra::Base class will also</span>
<span class="line-numbers">18</span><span class="comment">#   run the web app</span></code></pre>
<p>You can put lots of things inside the config.ru, but we'll get to that later on</p>
<h1 id="routes">4. Routes</h1>
<p>

</p><pre><code class="language-ruby"><span class="line-numbers">10</span>require <span class="string"><span class="delimiter">'</span><span class="content">rubygems</span><span class="delimiter">'</span></span> <span class="keyword">if</span> <span class="predefined-constant">RUBY_VERSION</span> &lt; <span class="string"><span class="delimiter">'</span><span class="content">1.9</span><span class="delimiter">'</span></span>
<span class="line-numbers">11</span>require <span class="string"><span class="delimiter">'</span><span class="content">sinatra</span><span class="delimiter">'</span></span>
<span class="line-numbers">12</span>
<span class="line-numbers">13</span><span class="keyword">class</span> <span class="class">Route</span> &lt; <span class="constant">Sinatra</span>::<span class="constant">Base</span> 
<span class="line-numbers">14</span>
<span class="line-numbers">15</span>    get <span class="string"><span class="delimiter">'</span><span class="content">/</span><span class="delimiter">'</span></span> <span class="keyword">do</span>
<span class="line-numbers">16</span>        <span class="string"><span class="delimiter">"</span><span class="content">Landing page</span><span class="delimiter">"</span></span>
<span class="line-numbers">17</span>    <span class="keyword">end</span>
<span class="line-numbers">18</span>
<span class="line-numbers">19</span>    get <span class="string"><span class="delimiter">'</span><span class="content">/client</span><span class="delimiter">'</span></span> <span class="keyword">do</span>
<span class="line-numbers">20</span>        <span class="string"><span class="delimiter">"</span><span class="content">Client page</span><span class="delimiter">"</span></span>
<span class="line-numbers">21</span>    <span class="keyword">end</span>
<span class="line-numbers">22</span>
<span class="line-numbers">23</span>    get <span class="string"><span class="delimiter">'</span><span class="content">/contact</span><span class="delimiter">'</span></span> <span class="keyword">do</span>
<span class="line-numbers">24</span>        <span class="string"><span class="delimiter">"</span><span class="content">Contact page</span><span class="delimiter">"</span></span>
<span class="line-numbers">25</span>    <span class="keyword">end</span>
<span class="line-numbers">26</span><span class="keyword">end</span></code></pre>
<p><strong>get</strong> is a method call, its not a method definition, this is one of the reasons why Sinatra is DSL (Domain Specific Language), its domain is RESTful web apps</p>
<h2 id="querystring-parameters">4.1 QueryString parameters</h2>
<p>

</p><pre><code class="language-ruby"><span class="line-numbers">10</span>require <span class="string"><span class="delimiter">'</span><span class="content">rubygems</span><span class="delimiter">'</span></span> <span class="keyword">if</span> <span class="predefined-constant">RUBY_VERSION</span> &lt; <span class="string"><span class="delimiter">'</span><span class="content">1.9</span><span class="delimiter">'</span></span>
<span class="line-numbers">11</span>require <span class="string"><span class="delimiter">'</span><span class="content">sinatra</span><span class="delimiter">'</span></span>
<span class="line-numbers">12</span>
<span class="line-numbers">13</span><span class="keyword">class</span> <span class="class">Route</span> &lt; <span class="constant">Sinatra</span>::<span class="constant">Base</span> 
<span class="line-numbers">14</span>
<span class="line-numbers">15</span>    get <span class="string"><span class="delimiter">'</span><span class="content">/</span><span class="delimiter">'</span></span> <span class="keyword">do</span>
<span class="line-numbers">16</span>        <span class="string"><span class="delimiter">"</span><span class="content">Landing page</span><span class="delimiter">"</span></span>
<span class="line-numbers">17</span>    <span class="keyword">end</span>
<span class="line-numbers">18</span>
<span class="line-numbers">19</span>    get <span class="string"><span class="delimiter">'</span><span class="content">/client/:clientname</span><span class="delimiter">'</span></span> <span class="keyword">do</span>
<span class="line-numbers">20</span>    
<span class="line-numbers">21</span>        param = params[<span class="symbol">:clientname</span>]
<span class="line-numbers">22</span>        <span class="string"><span class="delimiter">"</span><span class="content">You searched for </span><span class="inline"><span class="inline-delimiter">#{</span>param<span class="inline-delimiter">}</span></span><span class="delimiter">"</span></span>
<span class="line-numbers">23</span>
<span class="line-numbers">24</span>    <span class="keyword">end</span>
<span class="line-numbers">25</span>
<span class="line-numbers">26</span>    get <span class="string"><span class="delimiter">'</span><span class="content">/contact</span><span class="delimiter">'</span></span> <span class="keyword">do</span>
<span class="line-numbers">27</span>        <span class="string"><span class="delimiter">"</span><span class="content">Contact page</span><span class="delimiter">"</span></span>
<span class="line-numbers">28</span>    <span class="keyword">end</span>
<span class="line-numbers">29</span><span class="keyword">end</span></code></pre>
<p>QueryString parameters can be accessed using the <strong>params</strong> array, make sure that querystring arguments is a ruby symbol. The get/client call has two lines inside it, but only the last line (which is a string) will be returned by the HTTP request</p>
<h2 id="optional-trailing-slash">4.2 Optional trailing slash</h2>
<p>Make the trailing slash optional in QueryString by adding <strong>/?</strong> in the get method</p>
<pre><code class="language-ruby"><span class="line-numbers">10</span>require <span class="string"><span class="delimiter">'</span><span class="content">rubygems</span><span class="delimiter">'</span></span> <span class="keyword">if</span> <span class="predefined-constant">RUBY_VERSION</span> &lt; <span class="string"><span class="delimiter">'</span><span class="content">1.9</span><span class="delimiter">'</span></span>
<span class="line-numbers">11</span>require <span class="string"><span class="delimiter">'</span><span class="content">sinatra</span><span class="delimiter">'</span></span>
<span class="line-numbers">12</span>require <span class="string"><span class="delimiter">'</span><span class="content">sinatra/reloader</span><span class="delimiter">'</span></span> <span class="keyword">if</span> development?
<span class="line-numbers">13</span>
<span class="line-numbers">14</span><span class="keyword">class</span> <span class="class">Route</span> &lt; <span class="constant">Sinatra</span>::<span class="constant">Base</span> 
<span class="line-numbers">15</span>
<span class="line-numbers">16</span>    configure <span class="symbol">:development</span> <span class="keyword">do</span>
<span class="line-numbers">17</span>        register <span class="constant">Sinatra</span>::<span class="constant">Reloader</span>
<span class="line-numbers">18</span>    <span class="keyword">end</span>
<span class="line-numbers">19</span>
<span class="line-numbers">20</span>    get <span class="string"><span class="delimiter">'</span><span class="content">/</span><span class="delimiter">'</span></span> <span class="keyword">do</span>
<span class="line-numbers">21</span>        <span class="string"><span class="delimiter">"</span><span class="content">Landing page</span><span class="delimiter">"</span></span>
<span class="line-numbers">22</span>    <span class="keyword">end</span>
<span class="line-numbers">23</span>
<span class="line-numbers">24</span>    get <span class="string"><span class="delimiter">'</span><span class="content">/client/:clientname/?</span><span class="delimiter">'</span></span> <span class="keyword">do</span>
<span class="line-numbers">25</span>    
<span class="line-numbers">26</span>        param = params[<span class="symbol">:clientname</span>]
<span class="line-numbers">27</span>        <span class="string"><span class="delimiter">"</span><span class="content">You searched for </span><span class="inline"><span class="inline-delimiter">#{</span>param<span class="inline-delimiter">}</span></span><span class="delimiter">"</span></span>
<span class="line-numbers">28</span>
<span class="line-numbers">29</span>    <span class="keyword">end</span>
<span class="line-numbers">30</span>
<span class="line-numbers">31</span>    get <span class="string"><span class="delimiter">'</span><span class="content">/contact</span><span class="delimiter">'</span></span> <span class="keyword">do</span>
<span class="line-numbers">32</span>        <span class="string"><span class="delimiter">"</span><span class="content">Contact page</span><span class="delimiter">"</span></span>
<span class="line-numbers">33</span>    <span class="keyword">end</span>
<span class="line-numbers">34</span>
<span class="line-numbers">35</span><span class="keyword">end</span></code></pre>
<p>

</p><h1 id="hot-reloading">5. Hot reloading</h1>
<p>The default setup of Sinatra will not detect any changes in your source file, which means everytime you make a change in the source, you need to stop (CTRL-C) the web server, then start it again. The Sinatra Reloader can help with this.</p>
<p>Before you can use the Sinatra::Reloader, you need to get the gem first. <strong>gem install sintra-contrib</strong></p>
<pre><code class="language-ruby"><span class="line-numbers">10</span>require <span class="string"><span class="delimiter">'</span><span class="content">rubygems</span><span class="delimiter">'</span></span> <span class="keyword">if</span> <span class="predefined-constant">RUBY_VERSION</span> &lt; <span class="string"><span class="delimiter">'</span><span class="content">1.9</span><span class="delimiter">'</span></span>
<span class="line-numbers">11</span>require <span class="string"><span class="delimiter">'</span><span class="content">sinatra</span><span class="delimiter">'</span></span>
<span class="line-numbers">12</span>require <span class="string"><span class="delimiter">'</span><span class="content">sinatra/reloader</span><span class="delimiter">'</span></span> <span class="keyword">if</span> development?
<span class="line-numbers">13</span>
<span class="line-numbers">14</span><span class="keyword">class</span> <span class="class">Route</span> &lt; <span class="constant">Sinatra</span>::<span class="constant">Base</span> 
<span class="line-numbers">15</span>
<span class="line-numbers">16</span>    configure <span class="symbol">:development</span> <span class="keyword">do</span>
<span class="line-numbers">17</span>        register <span class="constant">Sinatra</span>::<span class="constant">Reloader</span>
<span class="line-numbers">18</span>    <span class="keyword">end</span>
<span class="line-numbers">19</span>
<span class="line-numbers">20</span>    <span class="comment"># APP methods</span>
<span class="line-numbers">21</span>
<span class="line-numbers">22</span>    get <span class="string"><span class="delimiter">'</span><span class="content">/</span><span class="delimiter">'</span></span> <span class="keyword">do</span>
<span class="line-numbers">23</span>        <span class="string"><span class="delimiter">"</span><span class="content">Landing page</span><span class="delimiter">"</span></span>
<span class="line-numbers">24</span>    <span class="keyword">end</span>
<span class="line-numbers">25</span>
<span class="line-numbers">26</span>    get <span class="string"><span class="delimiter">'</span><span class="content">/client/:clientname</span><span class="delimiter">'</span></span> <span class="keyword">do</span>
<span class="line-numbers">27</span>    
<span class="line-numbers">28</span>        param = params[<span class="symbol">:clientname</span>]
<span class="line-numbers">29</span>        <span class="string"><span class="delimiter">"</span><span class="content">You searched for </span><span class="inline"><span class="inline-delimiter">#{</span>param<span class="inline-delimiter">}</span></span><span class="delimiter">"</span></span>
<span class="line-numbers">30</span>
<span class="line-numbers">31</span>    <span class="keyword">end</span>
<span class="line-numbers">32</span>
<span class="line-numbers">33</span>    get <span class="string"><span class="delimiter">'</span><span class="content">/contact</span><span class="delimiter">'</span></span> <span class="keyword">do</span>
<span class="line-numbers">34</span>        <span class="string"><span class="delimiter">"</span><span class="content">Contact page</span><span class="delimiter">"</span></span>
<span class="line-numbers">35</span>    <span class="keyword">end</span>
<span class="line-numbers">36</span>
<span class="line-numbers">37</span><span class="keyword">end</span></code></pre>
<p>Just <em>require</em> the sinatra/reloader and register it inside your app, like the code above. Now, there is no need to restart the web server when changes occur in the source file. Use this only for development, not in production. There are other ways to achieve hot-reloading, go to the <a href="http://www.sinatrarb.com/faq.html">Sinatra FAQ</a></p>
	  </div>
		<p/>

    <A HREF="http://www.copyscape.com/plagiarism-check/" style="border:0"><IMG SRC="http://banners.copyscape.com/images/cs-wh-120x60.gif" ALT="Protected by Copyscape Web Plagiarism Check" TITLE="Protected by Copyscape Plagiarism Checker - Do not copy content from this page." WIDTH="120" HEIGHT="60" BORDER="0"></A>
    <!-- Start of StatCounter Code for Default Guide -->
	
  <script type="text/javascript">
  var sc_project=7827488; 
  var sc_invisible=1; 
  var sc_security="069357c9"; 
  </script>
  <script type="text/javascript"
      src="http://www.statcounter.com/counter/counter.js"></script>
  <noscript><div class="statcounter"><a title="customizable
      counter" href="http://statcounter.com/free-hit-counter/"
      target="_blank"><img class="statcounter"
      src="http://c.statcounter.com/7827488/0/069357c9/1/"
      alt="customizable counter"></a></div></noscript>
  <!-- End of StatCounter Code for Default Guide -->
   
    <footer>
      &copy 2012-2013 theLogBox.com 

    </foter>

    </div>
  </body>

</html>
